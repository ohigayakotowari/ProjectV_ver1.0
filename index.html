<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>project V</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            /* ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒåŸºèª¿ */
            --bg-primary: #f5f7fa;
            /* æ˜ã‚‹ã„ã‚°ãƒ¬ãƒ¼ */
            --bg-secondary: #ffffff;
            /* ç™½ */
            --bg-card: #ffffff;

            /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ - ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆç¢ºä¿ */
            --accent-attack: #d32f2f;
            /* æ¿ƒã„èµ¤ */
            --accent-defense: #0097a7;
            /* æ¿ƒã„ã‚·ã‚¢ãƒ³ */
            --accent-gold: #fbc02d;
            /* ã‚´ãƒ¼ãƒ«ãƒ‰ */

            /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ */
            --text-primary: #1a237e;
            /* æ¿ƒç´º */
            --text-secondary: #455a64;
            /* æ¿ƒã„ã‚°ãƒ¬ãƒ¼ */
            --text-light: #ffffff;

            --gradient-attack: linear-gradient(135deg, #d32f2f, #b71c1c);
            --gradient-defense: linear-gradient(135deg, #0097a7, #006064);
            --border-color: #cfd8dc;

            /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
            --shadow-card: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 12px rgba(0, 0, 0, 0.15);
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /* æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå„ªå…ˆ */
            font-family: "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 30px;
            box-shadow: var(--shadow-card);
        }

        .game-title {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 3px;
            color: var(--accent-attack);
        }

        .game-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .score-display {
            display: flex;
            gap: 15px;
        }

        .score-box {
            padding: 10px 25px;
            text-align: center;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-card);
            background: white;
            border: 1px solid var(--border-color);
        }

        .score-box.attack {
            border-bottom: 4px solid var(--accent-attack);
        }

        .score-box.defense {
            border-bottom: 4px solid var(--accent-defense);
        }

        #title-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
        }

        .logo {
            font-size: 5rem;
            font-weight: 900;
            letter-spacing: 5px;
            color: var(--accent-attack);
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 50px;
            letter-spacing: 5px;
            text-transform: uppercase;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 700;
            font-family: inherit;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: var(--radius-md);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 48px;
            /* ã‚¯ãƒªãƒƒã‚¯é ˜åŸŸç¢ºä¿ */
        }

        .btn-primary {
            background: var(--accent-attack);
            color: white;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(211, 47, 47, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: #f5f5f5;
            border-color: var(--text-secondary);
        }

        .btn:disabled {
            background: #e0e0e0;
            color: #9e9e9e;
            border: 1px solid #bdbdbd;
            box-shadow: none;
            opacity: 1;
            /* è–„ãã›ãšã«ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ */
            cursor: not-allowed;
            transform: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .pick-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .pick-header h2 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 3px;
        }

        .player-indicator {
            display: inline-block;
            padding: 8px 25px;
            font-weight: 700;
            letter-spacing: 2px;
            clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
        }

        .player-indicator.p1 {
            background: var(--gradient-attack);
        }

        .player-indicator.p2 {
            background: var(--gradient-defense);
            color: var(--bg-primary);
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        /* VALORANTé¢¨ãƒ”ãƒƒã‚¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .pick-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .agent-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .agent-tile {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .agent-tile:hover {
            border-color: var(--accent-attack);
        }

        .agent-tile.active {
            border-color: var(--accent-attack);
            background: rgba(255, 70, 85, 0.1);
        }

        .agent-tile.picked {
            opacity: 0.5;
            /* pointer-events: none; ã‚’å‰Šé™¤ - ãƒŸãƒ©ãƒ¼ãƒ”ãƒƒã‚¯å¯¾å¿œ */
            /* é¸æŠæ¸ˆã¿è¡¨ç¤ºã®ã¿ã€‚ã‚¯ãƒªãƒƒã‚¯å¯å¦ã¯JSå´ã§åˆ¶å¾¡ */
        }

        .agent-tile.opponent-picked {
            /* ç›¸æ‰‹ãŒé¸æŠä¸­ï¼šé¸æŠå¯èƒ½ã ãŒè¦–è¦šçš„ã«è¡¨ç¤º */
            border-color: var(--accent-defense);
            background: rgba(0, 200, 200, 0.1);
        }

        .agent-tile.opponent-picked::after {
            content: 'ç›¸æ‰‹é¸æŠä¸­';
            display: block;
            font-size: 0.65rem;
            color: var(--accent-defense);
            margin-top: 5px;
        }

        .agent-tile .tile-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .agent-tile .tile-name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .agent-detail {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 25px;
            min-height: 400px;
        }

        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        .detail-icon {
            font-size: 4rem;
        }

        .detail-name {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .detail-abilities {
            margin-top: 20px;
        }

        .detail-ability {
            background: var(--bg-card);
            border-left: 3px solid var(--accent-attack);
            padding: 15px;
            margin-bottom: 12px;
        }

        .detail-ability-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .detail-ability-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .detail-ability-cost {
            font-size: 1rem;
            color: var(--accent-attack);
            font-weight: 700;
            margin-top: 5px;
        }

        .detail-add-btn {
            margin-top: 30px;
            width: 100%;
        }

        .agent-card {
            background: white;
            padding: 20px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            transition: all 0.2s ease;
        }

        .agent-card:hover {
            border-color: var(--border-color);
            /* ãƒ›ãƒãƒ¼æ™‚ã¯å½±ã§è¡¨ç¾ */
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .agent-card.selected {
            border-color: var(--accent-attack);
            box-shadow: 0 0 0 2px var(--accent-attack);
        }

        .agent-card.disabled {
            opacity: 0.5;
            background: #f0f0f0;
            box-shadow: none;
            cursor: not-allowed;
            pointer-events: none;
        }

        .agent-card.killed {
            opacity: 0.3;
            border-color: #ff0000;
        }

        .agent-card.killed::after {
            content: "KILLED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            padding: 5px 20px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .card-portrait {
            width: 100%;
            height: 100px;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .card-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
            letter-spacing: 1px;
        }

        .card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            font-size: 0.8rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: #f5f7fa;
            border-radius: 4px;
            font-weight: 600;
        }

        .stat-dmg {
            color: #c62828;
        }

        .stat-entry {
            color: #00897b;
        }

        .stat-area {
            color: #f9a825;
        }

        .stat-retake {
            color: #5e35b1;
        }

        .selected-deck {
            background: var(--bg-secondary);
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .selected-deck h3 {
            margin-bottom: 15px;
            font-weight: 600;
            letter-spacing: 2px;
        }

        .deck-cards {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            min-height: 100px;
        }

        .deck-slot {
            width: 90px;
            height: 110px;
            background: #f9f9f9;
            border: 2px dashed var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
        }

        .deck-slot.filled {
            border-style: solid;
            border-color: var(--accent-attack);
        }

        .deck-slot .mini-name {
            font-size: 0.7rem;
            text-align: center;
            padding: 5px;
        }

        .credits {
            font-size: 1.8rem;
            color: var(--accent-gold);
            font-weight: 700;
        }

        .ability-list {
            margin-top: 15px;
        }

        .ability-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: white;
            margin-bottom: 8px;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            border: 1px solid var(--border-color);
            border-left-width: 4px;
            border-radius: var(--radius-md);
        }

        .ability-item:hover {
            background: #f5f5f5;
            border-left-color: var(--accent-attack);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .ability-item.purchased {
            background: #e0f2f1;
            border-left-color: var(--accent-defense);
            border-color: #b2dfdb;
        }

        .ability-name {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .ability-cost {
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 1rem;
        }

        .ability-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
            line-height: 1.4;
        }

        .round-container {
            text-align: center;
        }

        .phase-display {
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: 2px;
            margin: 30px 0;
            padding: 25px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .result-section {
            background: white;
            padding: 40px;
            margin: 30px 0;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-color);
        }

        .result-section h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 2px;
        }

        .stats-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: center;
        }

        .stats-column {
            text-align: center;
        }

        .stats-column h4 {
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .stat-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 1rem;
        }

        .vs-divider {
            font-size: 2rem;
            color: var(--text-secondary);
            font-weight: 900;
            background: #eceff1;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 50%;
            margin: 0 auto;
        }

        .plant-badge {
            display: inline-block;
            padding: 20px 50px;
            font-size: 1.5rem;
            font-weight: 900;
            letter-spacing: 2px;
            margin: 30px 0;
            border-radius: var(--radius-lg);
            color: white;
            box-shadow: var(--shadow-card);
        }

        .plant-badge.complete {
            background: var(--gradient-attack);
        }

        .plant-badge.incomplete {
            background: var(--gradient-defense);
            color: var(--bg-primary);
        }

        .kill-info {
            font-size: 1.5rem;
            margin: 15px 0;
            font-weight: 700;
        }

        .kill-select-grid {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .kill-select-card {
            background: white;
            padding: 20px;
            cursor: pointer;
            border: 2px solid var(--border-color);
            transition: all 0.2s;
            width: 240px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        .kill-select-card:hover {
            border-color: var(--accent-attack);
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .kill-select-card.selected {
            border-color: var(--accent-attack);
            background: #ffebee;
            /* è–„ã„èµ¤èƒŒæ™¯ */
            box-shadow: 0 0 0 2px var(--accent-attack);
        }

        .ability-badge {
            display: inline-block;
            padding: 4px 10px;
            font-size: 0.75rem;
            background: var(--accent-defense);
            color: white;
            font-weight: 700;
            letter-spacing: 0.5px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .winner-display {
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 2px;
            padding: 40px;
            margin: 40px 0;
            border-radius: var(--radius-lg);
            color: white;
            /* èƒŒæ™¯ã«ã‚ˆã‚‹ã®ã§ç™½æ–‡å­— */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .winner-display.attack {
            background: var(--gradient-attack);
        }

        .winner-display.defense {
            background: var(--gradient-defense);
        }

        .winner-display.draw {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        #end-screen {
            text-align: center;
            padding: 50px;
        }

        .final-result {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 30px;
            letter-spacing: 5px;
        }

        .final-scores {
            font-size: 1.5rem;
            margin-bottom: 40px;
        }

        .fade-in {
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 30px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .rules-text {
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .rules-text h3 {
            color: var(--accent-attack);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .rules-text ul,
        .rules-text ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .rules-text li {
            margin-bottom: 5px;
        }

        /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <header class="game-header hidden" id="game-header">
        <div class="game-title">PROJECT V</div>
        <div class="game-info">
            <div class="info-item">
                <div class="info-label">ãƒ©ã‚¦ãƒ³ãƒ‰</div>
                <div class="info-value" id="round-display">1 / 4</div>
            </div>
            <div class="info-item">
                <div class="info-label">ã‚»ãƒƒãƒˆ</div>
                <div class="info-value" id="set-display">A</div>
            </div>
            <div class="score-display">
                <div class="score-box attack">
                    <div class="info-label" id="p1-role-label">P1 ATK</div>
                    <div class="info-value" id="p1-score">0</div>
                </div>
                <div class="score-box defense">
                    <div class="info-label" id="p2-role-label">P2 DEF</div>
                    <div class="info-value" id="p2-score">0</div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="title-screen">
            <h1 class="logo">PROJECT V</h1>
            <p class="subtitle">ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </p>
            <div style="display:flex;flex-direction:column;gap:15px;margin-top:30px;">
                <button class="btn btn-primary" onclick="startPvP()">âš”ï¸ PvPï¼ˆ2äººå¯¾æˆ¦ï¼‰</button>
                <button class="btn btn-secondary" onclick="showNpcSelect()">ğŸ¤– PvEï¼ˆNPCæˆ¦ï¼‰</button>
                <button class="btn btn-secondary" onclick="showRulesModal()" style="margin-top:20px;">ğŸ“– ãƒ«ãƒ¼ãƒ«èª¬æ˜</button>
            </div>
        </div>

        <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="rules-modal" class="modal hidden">
            <div class="modal-content">
                <h2 style="margin-bottom:20px;">ğŸ“– ãƒ«ãƒ¼ãƒ«èª¬æ˜</h2>
                <div class="rules-text">
                    <h3>åŸºæœ¬ãƒ«ãƒ¼ãƒ«</h3>
                    <ul>
                        <li>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯5æšã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ã‚’ä½¿ã†</li>
                        <li>å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆæœŸåŸºæœ¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼šãƒ€ãƒ¡ãƒ¼ã‚¸100 / ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ‘ãƒ¯ãƒ¼1 / ã‚¨ãƒªã‚¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«åŠ›1 / ãƒªãƒ†ã‚¤ã‚¯ãƒ‘ãƒ¯ãƒ¼1</li>
                    </ul>
                    <h3>ã‚­ãƒ£ãƒ©ãƒ”ãƒƒã‚¯</h3>
                    <ul>
                        <li>ç›¸æ‰‹ã¨åŒã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸ã‚“ã§ã‚‚ã‚ˆã„ï¼ˆãƒŸãƒ©ãƒ¼ãƒ”ãƒƒã‚¯OKï¼‰</li>
                    </ul>
                    <h3>ãƒã‚¤ãƒ•ã‚§ãƒ¼ã‚º</h3>
                    <ul>
                        <li>æ¯ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹æ™‚ã«ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆãŒ +1500 è¿½åŠ ã•ã‚Œã‚‹ï¼ˆä½¿ã‚ãªã‹ã£ãŸåˆ†ã¯æŒã¡è¶Šã—ï¼‰</li>
                        <li>è³¼å…¥ã—ãŸã‚¢ãƒ“ãƒªãƒ†ã‚£ã¯ã€ãã®è©¦åˆä¸­ã¯äºŒåº¦ã¨è³¼å…¥ã§ããªã„ï¼ˆæ”»é˜²äº¤ä»£å¾Œã‚‚åŒæ§˜ï¼‰</li>
                        <li>ã‚¢ãƒ“ãƒªãƒ†ã‚£åŠ¹æœã¯è³¼å…¥ã—ãŸãƒ©ã‚¦ãƒ³ãƒ‰ã®ã¿æœ‰åŠ¹</li>
                    </ul>
                    <h3>ãƒ©ã‚¦ãƒ³ãƒ‰é€²è¡Œ</h3>
                    <ol>
                        <li>ç”Ÿå­˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†è¨ˆ</li>
                        <li><strong>ãƒ—ãƒ©ãƒ³ãƒˆåˆ¤å®š</strong>ï¼šæ”»æ’ƒã®ç·ã‚¨ãƒ³ãƒˆãƒªãƒ¼ > é˜²è¡£ã®ç·ã‚¨ãƒªã‚¢ ãªã‚‰ãƒ—ãƒ©ãƒ³ãƒˆå®Œäº†</li>
                        <li><strong>ã‚­ãƒ«æ•°è¨ˆç®—</strong>ï¼šç·ãƒ€ãƒ¡ãƒ¼ã‚¸150ã”ã¨ã«ç›¸æ‰‹ã‚’1ä½“ã‚­ãƒ«å¯èƒ½</li>
                        <li>ã‚­ãƒ«ã•ã‚Œã‚‹ã‚«ãƒ¼ãƒ‰ã¯ã€Œã‚­ãƒ«ã•ã‚Œã‚‹å´ãŒé¸ã¶ã€</li>
                        <li><strong>å‹æ•—åˆ¤å®š</strong>ã§1ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ï¼š
                            <ul>
                                <li>ä¸¡è€…å…¨æ»…ï¼šãƒ—ãƒ©ãƒ³ãƒˆå®Œäº†ãªã‚‰æ”»æ’ƒã€æœªå®Œäº†ãªã‚‰é˜²è¡£ã«1ç‚¹</li>
                                <li>ç‰‡å´å…¨æ»…ï¼šç”Ÿå­˜ãŒã„ã‚‹å´ã«1ç‚¹</li>
                                <li>ä¸¡è€…æ®‹ã‚Šã‚ã‚Šï¼šæ”»æ’ƒã¯ç·ã‚¨ãƒªã‚¢ã€é˜²è¡£ã¯ç·ãƒªãƒ†ã‚¤ã‚¯ã§æ¯”è¼ƒã—é«˜ã„å´ã«1ç‚¹ï¼ˆåŒå€¤ãªã‚‰ãƒ—ãƒ©ãƒ³ãƒˆã§æ±ºå®šï¼‰</li>
                            </ul>
                        </li>
                    </ol>
                    <h3>å‹åˆ©æ¡ä»¶</h3>
                    <ul>
                        <li>2ãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†ã§æ”»é˜²äº¤ä»£ã€åˆè¨ˆæœ€å¤§4ãƒ©ã‚¦ãƒ³ãƒ‰</li>
                        <li>å…ˆã«3ãƒã‚¤ãƒ³ãƒˆå–ã£ãŸå´ãŒå‹ã¡ã€2-2ã¯å¼•ãåˆ†ã‘</li>
                    </ul>
                </div>
                <button class="btn btn-primary" onclick="hideRulesModal()" style="margin-top:20px;">é–‰ã˜ã‚‹</button>
            </div>
        </div>

        <div id="npc-select-screen" class="hidden">
            <h2 style="font-size:1.8rem;letter-spacing:2px;margin-bottom:30px;">NPCå¯¾æˆ¦</h2>
            <div id="npc-level-select">
                <h3 style="margin-bottom:20px;color:var(--text-secondary);">é›£æ˜“åº¦ã‚’é¸æŠ</h3>
                <div style="display:flex;gap:15px;justify-content:center;flex-wrap:wrap;">
                    <button class="btn btn-secondary" onclick="showNpcList(1)">LEVEL 1ï¼ˆåˆå¿ƒè€…ï¼‰</button>
                    <button class="btn btn-secondary" onclick="showNpcList(2)">LEVEL 2ï¼ˆæ¨™æº–ï¼‰</button>
                    <button class="btn btn-secondary" onclick="showNpcList(3)">LEVEL 3ï¼ˆä¸Šç´šï¼‰</button>
                </div>
            </div>
            <div id="npc-list-container" class="hidden" style="margin-top:30px;"></div>
            <div class="nav-buttons" style="margin-top:30px;">
                <button class="btn btn-secondary" onclick="backToTitle()">æˆ»ã‚‹</button>
            </div>
        </div>

        <div id="pick-screen" class="hidden">
            <button class="btn btn-secondary back-btn" onclick="backToModeSelect()">â† æˆ»ã‚‹</button>
            <div class="pick-header">
                <h2>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé¸æŠ</h2>
                <div class="player-indicator" id="current-picker">P1ã®ã‚¿ãƒ¼ãƒ³</div>
                <p style="margin-top:10px;color:var(--text-secondary);">5ä½“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</p>
                <p style="margin-top:5px;color:var(--accent-attack);font-size:0.85rem;">â€»ãƒŸãƒ©ãƒ¼ãƒ”ãƒƒã‚¯å¯ï¼ˆç›¸æ‰‹ã¨åŒã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã§ãã¾ã™ï¼‰</p>
            </div>
            <div class="pick-layout">
                <div class="agent-list" id="agent-list"></div>
                <div class="agent-detail" id="agent-detail">
                    <p style="color:var(--text-secondary);text-align:center;padding:50px;">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
            </div>
            <div class="selected-deck">
                <h3>é¸æŠæ¸ˆã¿ (<span id="deck-count">0</span>/5)</h3>
                <div class="deck-cards" id="deck-cards"></div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="clearSelection()">ã‚¯ãƒªã‚¢</button>
                <button class="btn btn-primary" id="confirm-pick-btn" onclick="confirmPick()" disabled>ç¢ºå®š</button>
            </div>
        </div>

        <div id="buy-screen" class="hidden">
            <div class="pick-header">
                <h2>ãƒã‚¤ãƒ•ã‚§ãƒ¼ã‚º</h2>
                <div class="player-indicator" id="current-buyer">P1ã®ã‚¿ãƒ¼ãƒ³</div>
                <p style="margin-top:10px;color:var(--text-secondary);">ã‚¢ãƒ“ãƒªãƒ†ã‚£ã‚’è³¼å…¥ã—ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¼·åŒ–</p>
            </div>
            <div id="buy-cards-container"></div>
            <div class="nav-buttons">
                <button class="btn btn-primary" id="confirm-buy-btn" onclick="confirmBuy()">è³¼å…¥å®Œäº†</button>
            </div>
        </div>

        <div id="round-screen" class="hidden">
            <div class="round-container">
                <div class="phase-display" id="phase-display">ROUND</div>
                <div id="round-content"></div>
            </div>
        </div>

        <div id="kill-screen" class="hidden">
            <div class="round-container">
                <h2 style="font-size:1.8rem;letter-spacing:3px;">ã‚­ãƒ«é¸æŠ</h2>
                <p id="kill-instruction" style="margin:20px 0;font-size:1.1rem;"></p>
                <div class="kill-select-grid" id="kill-select-grid"></div>
                <div class="nav-buttons">
                    <button class="btn btn-primary" id="confirm-kill-btn" onclick="confirmKillSelection()"
                        disabled>é¸æŠç¢ºå®š</button>
                </div>
            </div>
        </div>

        <div id="end-screen" class="hidden">
            <div class="final-result" id="final-result"></div>
            <div class="final-scores" id="final-scores"></div>
            <button class="btn btn-primary" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
    </div>

    <script>
        const ABILITIES = {
            // ã‚¸ã‚§ãƒƒãƒˆ
            JT1: { id: 'JT1', name: 'Tã‚¦ã‚£ãƒ³ãƒ‰', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { damage: 50, entry: 1 } },
            JT2: { id: 'JT2', name: 'ã‚¢ãƒƒãƒ—ãƒ‰ãƒ©ãƒ•ãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            JT3: { id: 'JT3', name: 'Cãƒãƒ¼ã‚¹ãƒˆ', cost: 300, desc: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼+2', type: 'stat', effect: { entry: 2 } },
            // ã‚¢ã‚¤ã‚½
            IS1: { id: 'IS1', name: 'ã‚¢ãƒ³ãƒ€ãƒ¼ã‚«ãƒƒãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            IS2: { id: 'IS2', name: 'ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50, ç›¸æ‰‹ãƒ€ãƒ¡ãƒ¼ã‚¸-50', type: 'mixed', effect: { damage: 50, reduceEnemyDamage: 50 } },
            IS3: { id: 'IS3', name: 'ã‚³ãƒ³ãƒ†ã‚£ãƒ³ã‚¸ã‚§ãƒ³ã‚·ãƒ¼', cost: 300, desc: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { entry: 1 } },
            // ãƒã‚ªãƒ³
            NE1: { id: 'NE1', name: 'ãƒªãƒ¬ãƒ¼ãƒœãƒ«ãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            NE2: { id: 'NE2', name: 'ãƒã‚¤ã‚®ã‚¢', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { damage: 50 } },
            NE3: { id: 'NE3', name: 'ãƒ•ã‚¡ã‚¹ãƒˆãƒ¬ãƒ¼ãƒ³', cost: 300, desc: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { entry: 1 } },
            // ãƒ¬ã‚¤ãƒŠ
            RN1: { id: 'RN1', name: 'ãƒ‡ãƒã‚¦ã‚¢ãƒ¼', cost: 300, desc: 'ç›¸æ‰‹ãƒ€ãƒ¡ãƒ¼ã‚¸-50', type: 'debuff', effect: { reduceEnemyDamage: 50 } },
            RN2: { id: 'RN2', name: 'ãƒ‡ã‚£ã‚¹ãƒŸã‚¹', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            RN3: { id: 'RN3', name: 'ãƒªãƒ¼ã‚¢', cost: 300, desc: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1, ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { entry: 1, area: 1 } },
            // ã‚¢ã‚¹ãƒˆãƒ©
            AS1: { id: 'AS1', name: 'ãƒãƒ´ã‚¡ãƒ‘ãƒ«ã‚¹', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { retake: 1, area: 1 } },
            AS2: { id: 'AS2', name: 'ãƒãƒ“ãƒ¥ãƒ©', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒªã‚¢+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { retake: 1, area: 1, entry: 1 } },
            AS3: { id: 'AS3', name: 'ã‚°ãƒ©ãƒ“ãƒ†ã‚£ã‚¦ã‚§ãƒ«', cost: 300, desc: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1, ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { entry: 1, area: 1 } },
            // ã‚¯ãƒ­ãƒ¼ãƒ–
            CL1: { id: 'CL1', name: 'ãƒ¡ãƒ‰ãƒ«', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { damage: 50 } },
            CL2: { id: 'CL2', name: 'ãƒ«ãƒ¼ã‚¹', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            CL3: { id: 'CL3', name: 'ãƒ”ãƒƒã‚¯ãƒ»ãƒŸãƒ¼ãƒ»ã‚¢ãƒƒãƒ—', cost: 300, desc: 'ç›¸æ‰‹ãƒ€ãƒ¡ãƒ¼ã‚¸-50', type: 'debuff', effect: { reduceEnemyDamage: 50 } },
            // ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼
            VP1: { id: 'VP1', name: 'ãƒã‚¤ã‚ºãƒ³ã‚¯ãƒ©ã‚¦ãƒ‰', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1, ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { area: 1, damage: 50 } },
            VP2: { id: 'VP2', name: 'ãƒˆã‚­ã‚·ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1, ãƒªãƒ†ã‚¤ã‚¯+1', type: 'stat', effect: { area: 1, retake: 1 } },
            VP3: { id: 'VP3', name: 'ã‚¹ãƒãƒ¼ã‚¯ãƒã‚¤ãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+2', type: 'stat', effect: { area: 2 } },
            // ã‚½ãƒ¼ãƒ´ã‚¡
            SV1: { id: 'SV1', name: 'ã‚·ãƒ§ãƒƒã‚¯ãƒœãƒ«ãƒˆ', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { damage: 50 } },
            SV2: { id: 'SV2', name: 'ãƒªã‚³ãƒ³ãƒœãƒ«ãƒˆ', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { retake: 1, entry: 1 } },
            SV3: { id: 'SV3', name: 'Oãƒ‰ãƒ­ãƒ¼ãƒ³', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { retake: 1, entry: 1 } },
            // KAY/O
            KY1: { id: 'KY1', name: 'F/ãƒ‰ãƒ©ã‚¤ãƒ–', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { retake: 1, entry: 1 } },
            KY2: { id: 'KY2', name: '0/ãƒã‚¤ãƒ³ãƒˆ', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1, ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { retake: 1, entry: 1, area: 1 } },
            KY3: { id: 'KY3', name: 'ãƒ•ãƒ©ã‚°/ãƒ¡ãƒ³ãƒˆ', cost: 300, desc: 'ç›¸æ‰‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼-2', type: 'debuff', effect: { reduceEnemyEntry: 2 } },
            // ãƒ†ãƒ›
            TJ1: { id: 'TJ1', name: 'Sãƒ‰ãƒ­ãƒ¼ãƒ³', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            TJ2: { id: 'TJ2', name: 'Sãƒ‡ãƒªãƒãƒªãƒ¼', cost: 300, desc: 'ç›¸æ‰‹ãƒªãƒ†ã‚¤ã‚¯-2', type: 'debuff', effect: { reduceEnemyRetake: 2 } },
            TJ3: { id: 'TJ3', name: 'èª˜å°ã‚µãƒ«ãƒ´ã‚©', cost: 500, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50, ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { damage: 50, retake: 1, entry: 1 } },
            // ã‚¹ã‚«ã‚¤
            SK1: { id: 'SK1', name: 'Tãƒ–ãƒ¬ã‚¤ã‚¶ãƒ¼', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } },
            SK2: { id: 'SK2', name: 'ã‚¬ã‚¤ãƒ‡ã‚£ãƒ³ã‚°L', cost: 300, desc: 'ãƒªãƒ†ã‚¤ã‚¯+1, ã‚¨ãƒ³ãƒˆãƒªãƒ¼+1', type: 'stat', effect: { retake: 1, entry: 1 } },
            SK3: { id: 'SK3', name: 'ãƒªã‚°ãƒ­ã‚¦ã‚¹', cost: 400, desc: 'ç›¸æ‰‹ãƒ€ãƒ¡ãƒ¼ã‚¸-100', type: 'debuff', effect: { reduceEnemyDamage: 100 } },
            // ã‚­ãƒ«ã‚¸ãƒ§ã‚¤
            KJ1: { id: 'KJ1', name: 'ã‚¢ãƒ©ãƒ¼ãƒ ãƒœãƒƒãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+2', type: 'stat', effect: { area: 2 } },
            KJ2: { id: 'KJ2', name: 'ã‚¿ãƒ¬ãƒƒãƒˆ', cost: 300, desc: 'ã‚¨ãƒªã‚¢+2, ãƒ€ãƒ¡ãƒ¼ã‚¸+30', type: 'stat', effect: { area: 2, damage: 30 } },
            KJ3: { id: 'KJ3', name: 'ãƒŠãƒã‚¹ãƒ¯ãƒ¼ãƒ ', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { damage: 50 } },
            // ã‚µã‚¤ãƒ•ã‚¡ãƒ¼
            CY1: { id: 'CY1', name: 'Cã‚±ãƒ¼ã‚¸', cost: 300, desc: 'ã‚¨ãƒªã‚¢+2', type: 'stat', effect: { area: 2 } },
            CY2: { id: 'CY2', name: 'ã‚¹ãƒ‘ã‚¤ã‚«ãƒ¡ãƒ©', cost: 300, desc: 'ã‚¨ãƒªã‚¢+2', type: 'stat', effect: { area: 2 } },
            CY3: { id: 'CY3', name: 'Tãƒ¯ã‚¤ãƒ¤ãƒ¼', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+30, ç›¸æ‰‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼-2', type: 'mixed', effect: { damage: 30, reduceEnemyEntry: 2 } },
            // ãƒã‚§ãƒ³ãƒãƒ¼
            CH1: { id: 'CH1', name: 'ãƒ˜ãƒƒãƒ‰ãƒãƒ³ã‚¿ãƒ¼', cost: 300, desc: 'ãƒ€ãƒ¡ãƒ¼ã‚¸+50', type: 'stat', effect: { damage: 50 } },
            CH2: { id: 'CH2', name: 'ãƒ©ãƒ³ãƒ‡ãƒ´ãƒ¼', cost: 300, desc: 'ç›¸æ‰‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼-2', type: 'debuff', effect: { reduceEnemyEntry: 2 } },
            CH3: { id: 'CH3', name: 'Tãƒãƒ¼ã‚¯', cost: 300, desc: 'ã‚¨ãƒªã‚¢+1', type: 'stat', effect: { area: 1 } }
        };

        // å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…±é€šã®åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        const DEFAULT_BASE_STATS = { damage: 100, entry: 1, area: 1, retake: 1 };

        const AGENTS = [
            { id: '001', name: 'ã‚¸ã‚§ãƒƒãƒˆ', icon: 'ğŸ’¨', baseStats: DEFAULT_BASE_STATS, abilities: ['JT1', 'JT2', 'JT3'] },
            { id: '002', name: 'ã‚¢ã‚¤ã‚½', icon: 'ğŸ”®', baseStats: DEFAULT_BASE_STATS, abilities: ['IS1', 'IS2', 'IS3'] },
            { id: '003', name: 'ãƒã‚ªãƒ³', icon: 'âš¡', baseStats: DEFAULT_BASE_STATS, abilities: ['NE1', 'NE2', 'NE3'] },
            { id: '004', name: 'ãƒ¬ã‚¤ãƒŠ', icon: 'ğŸ‘ï¸', baseStats: DEFAULT_BASE_STATS, abilities: ['RN1', 'RN2', 'RN3'] },
            { id: '005', name: 'ã‚¢ã‚¹ãƒˆãƒ©', icon: 'ğŸŒŸ', baseStats: DEFAULT_BASE_STATS, abilities: ['AS1', 'AS2', 'AS3'] },
            { id: '006', name: 'ã‚¯ãƒ­ãƒ¼ãƒ–', icon: 'ğŸ¦‹', baseStats: DEFAULT_BASE_STATS, abilities: ['CL1', 'CL2', 'CL3'] },
            { id: '007', name: 'ãƒ´ã‚¡ã‚¤ãƒ‘ãƒ¼', icon: 'ğŸ', baseStats: DEFAULT_BASE_STATS, abilities: ['VP1', 'VP2', 'VP3'] },
            { id: '008', name: 'ã‚½ãƒ¼ãƒ´ã‚¡', icon: 'ğŸ¦…', baseStats: DEFAULT_BASE_STATS, abilities: ['SV1', 'SV2', 'SV3'] },
            { id: '009', name: 'KAY/O', icon: 'ğŸ¤–', baseStats: DEFAULT_BASE_STATS, abilities: ['KY1', 'KY2', 'KY3'] },
            { id: '010', name: 'ãƒ†ãƒ›', icon: 'ğŸ¯', baseStats: DEFAULT_BASE_STATS, abilities: ['TJ1', 'TJ2', 'TJ3'] },
            { id: '011', name: 'ã‚¹ã‚«ã‚¤', icon: 'ğŸ¦', baseStats: DEFAULT_BASE_STATS, abilities: ['SK1', 'SK2', 'SK3'] },
            { id: '012', name: 'ã‚­ãƒ«ã‚¸ãƒ§ã‚¤', icon: 'ğŸ”§', baseStats: DEFAULT_BASE_STATS, abilities: ['KJ1', 'KJ2', 'KJ3'] },
            { id: '013', name: 'ã‚µã‚¤ãƒ•ã‚¡ãƒ¼', icon: 'ğŸ“·', baseStats: DEFAULT_BASE_STATS, abilities: ['CY1', 'CY2', 'CY3'] },
            { id: '014', name: 'ãƒã‚§ãƒ³ãƒãƒ¼', icon: 'ğŸ©', baseStats: DEFAULT_BASE_STATS, abilities: ['CH1', 'CH2', 'CH3'] }
        ];

        // NPCå®šç¾©ï¼ˆ3ãƒ¬ãƒ™ãƒ«Ã—3äººæ ¼=9ä½“ï¼‰
        const NPCS = [
            // LEVEL 1ï¼ˆåˆå¿ƒè€…ï¼‰
            { id: 'L1-1', name: 'ãƒªãƒ³ã‚¯', level: 1, personality: 'ãƒãƒ©ãƒ³ã‚¹å‹', deck: ['001', '005', '007', '010', '012'], buyPriority: 'random', killPolicy: 'random' },
            { id: 'L1-2', name: 'ãƒ¬ãƒƒã‚¯ã‚¹', level: 1, personality: 'æ”»æ’ƒå¥½ã', deck: ['001', '003', '004', '002', '006'], buyPriority: 'damage', killPolicy: 'random' },
            { id: 'L1-3', name: 'ã‚·ãƒ¼ãƒ«ãƒ‰', level: 1, personality: 'å®ˆã‚Šå¥½ã', deck: ['007', '012', '013', '014', '005'], buyPriority: 'area', killPolicy: 'random' },
            // LEVEL 2ï¼ˆæ¨™æº–ï¼‰
            { id: 'L2-1', name: 'ãƒ–ãƒ¬ã‚¤ã‚º', level: 2, personality: 'ã‚¨ãƒ³ãƒˆãƒªãƒ¼é‡è¦–', deck: ['001', '003', '004', '008', '011'], buyPriority: 'entry', killPolicy: 'keepStrong' },
            { id: 'L2-2', name: 'ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³', level: 2, personality: 'ãƒªãƒ†ã‚¤ã‚¯é‡è¦–', deck: ['005', '008', '009', '010', '011'], buyPriority: 'retake', killPolicy: 'keepStrong' },
            { id: 'L2-3', name: 'ã‚µãƒœã‚¿ãƒ¼', level: 2, personality: 'å¦¨å®³é‡è¦–', deck: ['004', '006', '009', '011', '013'], buyPriority: 'debuff', killPolicy: 'keepStrong' },
            // LEVEL 3ï¼ˆä¸Šç´šï¼‰
            { id: 'L3-1', name: 'ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ã‚¹', level: 3, personality: 'ãƒ—ãƒ©ãƒ³ãƒˆæœ€é©åŒ–', deck: ['001', '003', '005', '008', '010'], buyPriority: 'plant', killPolicy: 'optimal' },
            { id: 'L3-2', name: 'ã‚¨ãƒ³ãƒ‡ãƒ¥ãƒ¼ãƒ­', level: 3, personality: 'æ®‹æ•°å‹è² ', deck: ['005', '007', '009', '010', '012'], buyPriority: 'survival', killPolicy: 'optimal' },
            { id: 'L3-3', name: 'ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼', level: 3, personality: 'ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼', deck: ['002', '006', '009', '011', '014'], buyPriority: 'counter', killPolicy: 'optimal' }
        ];

        let gameState = {
            phase: 'title', roundIndex: 1, setIndex: 1,
            gameMode: 'pvp', // 'pvp' or 'pve'
            selectedNpc: null, // PvEæ™‚ã®NPC
            roles: { attacker: 'P1', defender: 'P2' },
            scores: { P1: 0, P2: 0 },
            credits: { P1: 0, P2: 0 }, // ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹æ™‚ã«+1500ã•ã‚Œã‚‹
            decks: { P1: [], P2: [] },
            purchases: { P1: {}, P2: {} }, // ç¾ãƒ©ã‚¦ãƒ³ãƒ‰è³¼å…¥ï¼ˆã‚¢ãƒ“ãƒªãƒ†ã‚£åŠ¹æœç”¨ï¼‰
            matchPurchases: { P1: new Set(), P2: new Set() }, // è©¦åˆå…¨ä½“ã®è³¼å…¥å±¥æ­´ï¼ˆè³¼å…¥æ¨©åˆ©ç®¡ç†ç”¨ï¼‰
            killed: { P1: [], P2: [] },
            currentPicker: 'P1', currentBuyer: 'P1',
            tempSelection: [], plantComplete: false, computed: null,
            killCounts: { P1: 0, P2: 0 }, killSelecting: null, tempKillSelection: []
        };

        function $(id) { return document.getElementById(id); }
        function showScreen(screenId) {
            ['title-screen', 'npc-select-screen', 'pick-screen', 'buy-screen', 'round-screen', 'kill-screen', 'end-screen'].forEach(id => $(id).classList.add('hidden'));
            $(screenId).classList.remove('hidden');
            $('game-header').classList.toggle('hidden', screenId === 'title-screen' || screenId === 'npc-select-screen');
        }
        function updateHeader() {
            $('round-display').textContent = `${gameState.roundIndex} / 4`;
            $('set-display').textContent = gameState.setIndex === 1 ? 'A' : 'B';
            $('p1-score').textContent = gameState.scores.P1;
            $('p2-score').textContent = gameState.scores.P2;
            const p1Role = gameState.roles.attacker === 'P1' ? 'ATK' : 'DEF';
            const p2Role = gameState.roles.attacker === 'P2' ? 'ATK' : 'DEF';
            $('p1-role-label').textContent = `P1 ${p1Role}`;
            $('p2-role-label').textContent = `P2 ${p2Role}`;
        }

        // === ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒ»NPCé¸æŠ ===
        function backToTitle() {
            showScreen('title-screen');
        }

        function showRulesModal() {
            $('rules-modal').classList.remove('hidden');
        }

        function hideRulesModal() {
            $('rules-modal').classList.add('hidden');
        }

        function backToModeSelect() {
            // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetGameState();
            showScreen('title-screen');
        }

        function resetGameState() {
            gameState.phase = 'title';
            gameState.roundIndex = 1;
            gameState.setIndex = 1;
            gameState.gameMode = 'pvp';
            gameState.selectedNpc = null;
            gameState.roles = { attacker: 'P1', defender: 'P2' };
            gameState.scores = { P1: 0, P2: 0 };
            gameState.credits = { P1: 0, P2: 0 };
            gameState.decks = { P1: [], P2: [] };
            gameState.purchases = { P1: {}, P2: {} };
            gameState.matchPurchases = { P1: new Set(), P2: new Set() };
            gameState.killed = { P1: [], P2: [] };
            gameState.currentPicker = 'P1';
            gameState.currentBuyer = 'P1';
            gameState.tempSelection = [];
            gameState.plantComplete = false;
            gameState.computed = null;
            gameState.killCounts = { P1: 0, P2: 0 };
            gameState.killSelecting = null;
            gameState.tempKillSelection = [];
        }

        function showNpcSelect() {
            showScreen('npc-select-screen');
            $('npc-level-select').classList.remove('hidden');
            $('npc-list-container').classList.add('hidden');
        }

        function showNpcList(level) {
            const npcs = NPCS.filter(n => n.level === level);
            $('npc-list-container').innerHTML = `
                <h3 style="margin-bottom:15px;">LEVEL ${level} NPCé¸æŠ</h3>
                <div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;">
                    ${npcs.map(npc => `
                        <div class="npc-card" onclick="selectNpc('${npc.id}')" style="
                            background:var(--panel-bg);border:2px solid var(--border-color);border-radius:var(--radius-md);
                            padding:20px;min-width:180px;cursor:pointer;text-align:center;
                            transition:all 0.2s;box-shadow:var(--shadow-sm);">
                            <div style="font-size:2rem;">ğŸ¤–</div>
                            <div style="font-size:1.2rem;font-weight:bold;margin:10px 0;">${npc.name}</div>
                            <div style="color:var(--text-secondary);font-size:0.9rem;">${npc.personality}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            $('npc-list-container').classList.remove('hidden');
        }

        function selectNpc(npcId) {
            gameState.selectedNpc = NPCS.find(n => n.id === npcId);
            gameState.gameMode = 'pve';
            startGame();
        }

        function startPvP() {
            gameState.gameMode = 'pvp';
            gameState.selectedNpc = null;
            startGame();
        }

        function startGame() {
            gameState.roles.attacker = Math.random() < 0.5 ? 'P1' : 'P2';
            gameState.roles.defender = gameState.roles.attacker === 'P1' ? 'P2' : 'P1';
            gameState.currentPicker = 'P1';
            showScreen('pick-screen');
            renderAgentGrid();
            updatePickerUI();
        }

        // === NPC AIé–¢æ•° ===
        function npcPickDeck() {
            const npc = gameState.selectedNpc;
            if (!npc) return;
            const selectedAgents = npc.deck.map(agentId => {
                const agent = AGENTS.find(a => a.id === agentId);
                return { ...agent, currentStats: { ...agent.baseStats }, killed: false };
            });
            gameState.decks.P2 = selectedAgents;
        }

        function npcBuyAbilities() {
            const npc = gameState.selectedNpc;
            if (!npc) return;

            const buyer = 'P2';
            const availableAbilities = [];

            // è³¼å…¥å¯èƒ½ãªã‚¢ãƒ“ãƒªãƒ†ã‚£ã‚’åé›†
            gameState.decks[buyer].forEach(agent => {
                agent.abilities.forEach(abilityId => {
                    if (!gameState.matchPurchases[buyer].has(abilityId)) {
                        const ability = ABILITIES[abilityId];
                        if (gameState.credits[buyer] >= ability.cost) {
                            availableAbilities.push({ agentId: agent.id, abilityId, ability });
                        }
                    }
                });
            });

            // å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆ
            const prioritized = sortAbilitiesByPriority(availableAbilities, npc.buyPriority);

            // äºˆç®—å†…ã§è³¼å…¥
            for (const item of prioritized) {
                if (gameState.credits[buyer] >= item.ability.cost) {
                    if (!gameState.purchases[buyer][item.agentId]) {
                        gameState.purchases[buyer][item.agentId] = [];
                    }
                    gameState.purchases[buyer][item.agentId].push(item.abilityId);
                    gameState.credits[buyer] -= item.ability.cost;
                    gameState.matchPurchases[buyer].add(item.abilityId);
                }
            }
        }

        function sortAbilitiesByPriority(abilities, priority) {
            const isAttacker = gameState.roles.attacker === 'P2';

            return abilities.sort((a, b) => {
                const ea = a.ability.effect;
                const eb = b.ability.effect;

                let scoreA = 0, scoreB = 0;

                switch (priority) {
                    case 'random':
                        return Math.random() - 0.5;
                    case 'damage':
                        scoreA = (ea.damage || 0);
                        scoreB = (eb.damage || 0);
                        break;
                    case 'area':
                        scoreA = (ea.area || 0);
                        scoreB = (eb.area || 0);
                        break;
                    case 'entry':
                        scoreA = (ea.entry || 0);
                        scoreB = (eb.entry || 0);
                        break;
                    case 'retake':
                        scoreA = (ea.retake || 0);
                        scoreB = (eb.retake || 0);
                        break;
                    case 'debuff':
                        scoreA = (ea.reduceEnemyDamage || 0) + (ea.reduceEnemyEntry || 0) + (ea.reduceEnemyRetake || 0);
                        scoreB = (eb.reduceEnemyDamage || 0) + (eb.reduceEnemyEntry || 0) + (eb.reduceEnemyRetake || 0);
                        break;
                    case 'plant':
                        if (isAttacker) {
                            scoreA = (ea.entry || 0) * 2 + (ea.damage || 0);
                            scoreB = (eb.entry || 0) * 2 + (eb.damage || 0);
                        } else {
                            scoreA = (ea.area || 0) * 2 + (ea.retake || 0);
                            scoreB = (eb.area || 0) * 2 + (eb.retake || 0);
                        }
                        break;
                    case 'survival':
                        if (isAttacker) {
                            scoreA = (ea.area || 0) * 2 + (ea.damage || 0);
                            scoreB = (eb.area || 0) * 2 + (eb.damage || 0);
                        } else {
                            scoreA = (ea.retake || 0) * 2 + (ea.area || 0);
                            scoreB = (eb.retake || 0) * 2 + (eb.area || 0);
                        }
                        break;
                    case 'counter':
                        scoreA = (ea.reduceEnemyDamage || 0) * 2 + (ea.reduceEnemyEntry || 0) + (ea.reduceEnemyRetake || 0) + (ea.damage || 0);
                        scoreB = (eb.reduceEnemyDamage || 0) * 2 + (eb.reduceEnemyEntry || 0) + (eb.reduceEnemyRetake || 0) + (eb.damage || 0);
                        break;
                    default:
                        return Math.random() - 0.5;
                }
                return scoreB - scoreA;
            });
        }

        function npcSelectKillTargets(killCount) {
            const npc = gameState.selectedNpc;
            const player = 'P2';
            const aliveAgents = gameState.decks[player].filter(a => !a.killed);

            if (aliveAgents.length <= killCount) {
                return aliveAgents.map(a => a.id);
            }

            let sorted;
            switch (npc?.killPolicy) {
                case 'random':
                    sorted = aliveAgents.sort(() => Math.random() - 0.5);
                    break;
                case 'keepStrong':
                case 'optimal':
                    // è³¼å…¥æ¸ˆã¿ã‚¢ãƒ“ãƒªãƒ†ã‚£æ•°ãŒå¤šã„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ®‹ã™ï¼ˆå°‘ãªã„ã‚‚ã®ã‚’ã‚­ãƒ«å¯¾è±¡ã«ï¼‰
                    sorted = aliveAgents.sort((a, b) => {
                        const aPurchases = (gameState.purchases[player][a.id] || []).length;
                        const bPurchases = (gameState.purchases[player][b.id] || []).length;
                        return aPurchases - bPurchases; // è³¼å…¥å°‘ãªã„é †
                    });
                    break;
                default:
                    sorted = aliveAgents;
            }

            return sorted.slice(0, killCount).map(a => a.id);
        }

        function renderAgentGrid() {
            // VALORANTé¢¨ï¼šå·¦ã«ã‚¿ã‚¤ãƒ«ä¸€è¦§ã€å³ã«è©³ç´°ãƒ‘ãƒãƒ«
            $('agent-list').innerHTML = AGENTS.map(agent => `
                <div class="agent-tile" data-id="${agent.id}" onclick="showAgentDetail('${agent.id}')">
                    <div class="tile-icon">${agent.icon}</div>
                    <div class="tile-name">${agent.name}</div>
                </div>
            `).join('');
            gameState.selectedAgentId = null;
            updateAgentTileStates();
        }

        function showAgentDetail(agentId) {
            const agent = AGENTS.find(a => a.id === agentId);
            if (!agent) return;
            gameState.selectedAgentId = agentId;

            // ã‚¿ã‚¤ãƒ«ã®activeçŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.agent-tile').forEach(t => t.classList.remove('active'));
            document.querySelector(`.agent-tile[data-id="${agentId}"]`)?.classList.add('active');

            // ãƒŸãƒ©ãƒ¼ãƒ”ãƒƒã‚¯è¨±å¯ï¼šåŒä¸€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…ã®é‡è¤‡ã®ã¿ç¦æ­¢ï¼ˆç›¸æ‰‹ãŒé¸ã‚“ã§ã‚‚é¸æŠå¯èƒ½ï¼‰
            const currentPlayer = gameState.currentPicker;
            const isAlreadyPicked = gameState.tempSelection.includes(agentId) ||
                gameState.decks[currentPlayer].some(a => a.id === agentId);

            $('agent-detail').innerHTML = `
                <div class="detail-header">
                    <div class="detail-icon">${agent.icon}</div>
                    <div class="detail-name">${agent.name}</div>
                </div>
                <div class="detail-abilities">
                    <h4 style="margin-bottom:15px;color:var(--text-secondary);font-size:0.9rem;">ã‚¢ãƒ“ãƒªãƒ†ã‚£</h4>
                    ${agent.abilities.map(abilityId => {
                const ability = ABILITIES[abilityId];
                return `
                            <div class="detail-ability">
                                <div class="detail-ability-name">${ability.name}</div>
                                <div class="detail-ability-desc">åŠ¹æœ: ${ability.desc}</div>
                                <div class="detail-ability-cost">ä¾¡æ ¼: ${ability.cost} ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ</div>
                            </div>
                        `;
            }).join('')}
                </div>
                ${!isAlreadyPicked && gameState.tempSelection.length < 5 ? `
                    <button class="btn btn-primary detail-add-btn" onclick="addAgentToSelection('${agentId}')">é¸æŠã«è¿½åŠ </button>
                ` : isAlreadyPicked ? `
                    <button class="btn btn-secondary detail-add-btn" onclick="removeAgentFromSelection('${agentId}')" ${gameState.tempSelection.includes(agentId) ? '' : 'disabled'}>é¸æŠã‹ã‚‰å¤–ã™</button>
                ` : `
                    <p style="text-align:center;color:var(--text-secondary);margin-top:20px;">5ä½“é¸æŠæ¸ˆã¿</p>
                `}
            `;
        }

        function addAgentToSelection(agentId) {
            if (gameState.tempSelection.length >= 5) return;
            if (!gameState.tempSelection.includes(agentId)) {
                gameState.tempSelection.push(agentId);
                updateDeckDisplay();
                updateAgentTileStates();
                showAgentDetail(agentId);
            }
        }

        function removeAgentFromSelection(agentId) {
            const idx = gameState.tempSelection.indexOf(agentId);
            if (idx > -1) {
                gameState.tempSelection.splice(idx, 1);
                updateDeckDisplay();
                updateAgentTileStates();
                showAgentDetail(agentId);
            }
        }

        function updateAgentTileStates() {
            const currentPlayer = gameState.currentPicker;
            const opponent = currentPlayer === 'P1' ? 'P2' : 'P1';

            document.querySelectorAll('.agent-tile').forEach(tile => {
                const id = tile.dataset.id;

                // è‡ªåˆ†ãŒæ—¢ã«é¸æŠæ¸ˆã¿ï¼ˆåŒä¸€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å†…é‡è¤‡ç¦æ­¢ï¼‰
                const isPickedBySelf = gameState.tempSelection.includes(id) ||
                    gameState.decks[currentPlayer].some(a => a.id === id);

                // ç›¸æ‰‹ãŒé¸æŠä¸­ï¼ˆè¡¨ç¤ºã®ã¿ã€é¸æŠã¯å¯èƒ½ï¼‰
                const isPickedByOpponent = gameState.decks[opponent].some(a => a.id === id);

                tile.classList.toggle('picked', isPickedBySelf);
                tile.classList.toggle('opponent-picked', isPickedByOpponent && !isPickedBySelf);
            });
        }

        function selectAgent(agentId) {
            // æ—§é–¢æ•°ï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
            addAgentToSelection(agentId);
        }

        function updateDeckDisplay() {
            const deckCards = $('deck-cards');
            $('deck-count').textContent = gameState.tempSelection.length;
            deckCards.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                const agentId = gameState.tempSelection[i];
                if (agentId) {
                    const agent = AGENTS.find(a => a.id === agentId);
                    deckCards.innerHTML += `<div class="deck-slot filled"><div class="mini-name">${agent.icon}<br>${agent.name}</div></div>`;
                } else {
                    deckCards.innerHTML += `<div class="deck-slot">?</div>`;
                }
            }
            $('confirm-pick-btn').disabled = gameState.tempSelection.length !== 5;
        }

        function clearSelection() {
            gameState.tempSelection = [];
            updateDeckDisplay();
            updateAgentTileStates();
            $('agent-detail').innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:50px;">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>';
        }

        function updatePickerUI() {
            const indicator = $('current-picker');
            indicator.textContent = `${gameState.currentPicker}ã®ã‚¿ãƒ¼ãƒ³`;
            indicator.className = 'player-indicator ' + (gameState.currentPicker === 'P1' ? 'p1' : 'p2');
            updateAgentTileStates();
            gameState.tempSelection = [];
            updateDeckDisplay();
            $('agent-detail').innerHTML = '<p style="color:var(--text-secondary);text-align:center;padding:50px;">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>';
        }

        function confirmPick() {
            const selectedAgents = gameState.tempSelection.map(id => {
                const agent = AGENTS.find(a => a.id === id);
                return { ...agent, currentStats: { ...agent.baseStats }, killed: false };
            });
            gameState.decks[gameState.currentPicker] = selectedAgents;

            if (gameState.currentPicker === 'P1') {
                if (gameState.gameMode === 'pve') {
                    // PvE: NPCãŒè‡ªå‹•ã§ãƒ‡ãƒƒã‚­é¸æŠ
                    npcPickDeck();
                    startBuyPhase();
                } else {
                    // PvP: P2ã®ã‚¿ãƒ¼ãƒ³ã¸
                    gameState.currentPicker = 'P2';
                    updatePickerUI();
                }
            } else {
                startBuyPhase();
            }
        }

        function startBuyPhase() {
            // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç´¯ç©ï¼ˆãƒªã‚»ãƒƒãƒˆã›ãš+1500åŠ ç®—ï¼‰
            gameState.credits.P1 += 1500;
            gameState.credits.P2 += 1500;
            // ç¾ãƒ©ã‚¦ãƒ³ãƒ‰ã®è³¼å…¥ã‚’åˆæœŸåŒ–ï¼ˆã‚¢ãƒ“ãƒªãƒ†ã‚£åŠ¹æœç”¨ï¼‰
            gameState.purchases = { P1: {}, P2: {} };
            gameState.currentBuyer = 'P1';
            updateHeader();
            showScreen('buy-screen');
            renderBuyPhase();
        }

        function renderBuyPhase() {
            const buyer = gameState.currentBuyer;
            $('current-buyer').textContent = `${buyer}ã®ã‚¿ãƒ¼ãƒ³`;
            $('current-buyer').className = 'player-indicator ' + (buyer === 'P1' ? 'p1' : 'p2');
            const deck = gameState.decks[buyer];
            const purchases = gameState.purchases[buyer];

            $('buy-cards-container').innerHTML = `
            <div style="text-align:center;margin-bottom:20px;">
                <span class="credits">ğŸ’° æ®‹ã‚Šã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ: ${gameState.credits[buyer]}</span>
                <span style="margin-left:15px;color:var(--text-secondary);font-size:14px;">(ä»Šå›æ”¯çµ¦: +1500)</span>
            </div>
            <div class="agent-grid">
                ${deck.map(agent => {
                const agentPurchases = purchases[agent.id] || [];
                return `
                        <div class="agent-card">
                            <div class="card-portrait">${agent.icon}</div>
                            <div class="card-name">${agent.name}</div>
                            <div class="ability-list">
                                ${agent.abilities.map(abilityId => {
                    const ability = ABILITIES[abilityId];
                    const purchasedThisRound = agentPurchases.includes(abilityId);
                    const purchasedInMatch = gameState.matchPurchases[buyer].has(abilityId);
                    const canAfford = gameState.credits[buyer] >= ability.cost;
                    const isDisabled = purchasedInMatch && !purchasedThisRound; // éå»ãƒ©ã‚¦ãƒ³ãƒ‰ã§è³¼å…¥æ¸ˆã¿
                    return `
                                        <div class="ability-item ${purchasedThisRound ? 'purchased' : ''} ${isDisabled ? 'disabled-permanent' : ''}" 
                                             onclick="${isDisabled ? '' : `toggleAbility('${agent.id}', '${abilityId}')`}"
                                             style="${isDisabled ? 'opacity:0.5;cursor:not-allowed' : (!purchasedThisRound && !canAfford ? 'opacity:0.4' : 'cursor:pointer')}">
                                            <div>
                                                <div class="ability-name">
                                                    ${ability.name}
                                                    ${purchasedThisRound ? '<span class="ability-badge">è³¼å…¥æ¸ˆ</span>' : ''}
                                                    ${isDisabled ? '<span class="ability-badge" style="background:#666;">è³¼å…¥ä¸å¯</span>' : ''}
                                                </div>
                                                <div class="ability-desc">${ability.desc}</div>
                                            </div>
                                            <div class="ability-cost">${ability.cost}</div>
                                        </div>
                                    `;
                }).join('')}
                            </div>
                        </div>
                    `;
            }).join('')}
            </div>
        `;
        }

        function toggleAbility(agentId, abilityId) {
            const buyer = gameState.currentBuyer;
            const ability = ABILITIES[abilityId];

            // è©¦åˆä¸­ã«æ—¢ã«è³¼å…¥æ¸ˆã¿ã®å ´åˆã¯è³¼å…¥ä¸å¯
            if (gameState.matchPurchases[buyer].has(abilityId)) {
                return; // è³¼å…¥ä¸å¯
            }

            if (!gameState.purchases[buyer][agentId]) gameState.purchases[buyer][agentId] = [];
            const purchases = gameState.purchases[buyer][agentId];
            const idx = purchases.indexOf(abilityId);
            if (idx > -1) {
                // è³¼å…¥å–ã‚Šæ¶ˆã—ï¼ˆç¾ãƒ©ã‚¦ãƒ³ãƒ‰ã®ã¿ï¼‰
                purchases.splice(idx, 1);
                gameState.credits[buyer] += ability.cost;
                gameState.matchPurchases[buyer].delete(abilityId);
            }
            else if (gameState.credits[buyer] >= ability.cost) {
                // æ–°è¦è³¼å…¥
                purchases.push(abilityId);
                gameState.credits[buyer] -= ability.cost;
                gameState.matchPurchases[buyer].add(abilityId);
            }
            renderBuyPhase();
        }

        function confirmBuy() {
            if (gameState.currentBuyer === 'P1') {
                if (gameState.gameMode === 'pve') {
                    // PvE: NPCãŒè‡ªå‹•è³¼å…¥ã—ã¦ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹
                    npcBuyAbilities();
                    startRound();
                } else {
                    // PvP: P2ã®ã‚¿ãƒ¼ãƒ³ã¸
                    gameState.currentBuyer = 'P2';
                    renderBuyPhase();
                }
            } else {
                startRound();
            }
        }

        function startRound() {
            gameState.killed = { P1: [], P2: [] };
            gameState.decks.P1.forEach(a => a.killed = false);
            gameState.decks.P2.forEach(a => a.killed = false);
            showScreen('round-screen');
            showRoundReady();
        }

        function showRoundReady() {
            $('phase-display').textContent = `âš”ï¸ ãƒ©ã‚¦ãƒ³ãƒ‰ ${gameState.roundIndex}`;
            $('round-content').innerHTML = `
            <div class="result-section fade-in">
                <h3>ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹</h3>
                <p style="margin:20px 0;">ç”Ÿå­˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†è¨ˆã—ã¾ã™</p>
                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="stepCalculateStats()">é›†è¨ˆã™ã‚‹</button>
                </div>
            </div>
        `;
        }

        function stepCalculateStats() {
            $('phase-display').textContent = 'ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é›†è¨ˆ';
            const computed = calculateStats();
            gameState.computed = computed;
            $('round-content').innerHTML = `
            <div class="result-section fade-in">
                <h3>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é›†è¨ˆçµæœ</h3>
                <div class="stats-comparison">
                    <div class="stats-column">
                        <h4>${gameState.roles.attacker} (æ”»æ’ƒ)</h4>
                        <div class="stat-row stat-dmg">ğŸ’¥ ãƒ€ãƒ¡ãƒ¼ã‚¸: ${computed[gameState.roles.attacker].damage}</div>
                        <div class="stat-row stat-entry">ğŸš€ ã‚¨ãƒ³ãƒˆãƒªãƒ¼: ${computed[gameState.roles.attacker].entry}</div>
                        <div class="stat-row stat-area">ğŸ¯ ã‚¨ãƒªã‚¢: ${computed[gameState.roles.attacker].area}</div>
                        <div class="stat-row stat-retake">ğŸ”„ ãƒªãƒ†ã‚¤ã‚¯: ${computed[gameState.roles.attacker].retake}</div>
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="stats-column">
                        <h4>${gameState.roles.defender} (é˜²è¡›)</h4>
                        <div class="stat-row stat-dmg">ğŸ’¥ ãƒ€ãƒ¡ãƒ¼ã‚¸: ${computed[gameState.roles.defender].damage}</div>
                        <div class="stat-row stat-entry">ğŸš€ ã‚¨ãƒ³ãƒˆãƒªãƒ¼: ${computed[gameState.roles.defender].entry}</div>
                        <div class="stat-row stat-area">ğŸ¯ ã‚¨ãƒªã‚¢: ${computed[gameState.roles.defender].area}</div>
                        <div class="stat-row stat-retake">ğŸ”„ ãƒªãƒ†ã‚¤ã‚¯: ${computed[gameState.roles.defender].retake}</div>
                    </div>
                </div>
                <div class="nav-buttons" style="margin-top:30px;">
                    <button class="btn btn-primary" onclick="stepPlantDetermination()">ãƒ—ãƒ©ãƒ³ãƒˆåˆ¤å®šã¸</button>
                </div>
            </div>
        `;
        }

        function stepPlantDetermination() {
            $('phase-display').textContent = 'ğŸ’£ ãƒ—ãƒ©ãƒ³ãƒˆåˆ¤å®š';
            const atk = gameState.roles.attacker, def = gameState.roles.defender;
            const computed = gameState.computed;
            let attackEntry = computed[atk].entry;
            Object.values(gameState.purchases[atk]).flat().forEach(id => {
                if (ABILITIES[id].effect.plantEntryBonus) attackEntry += ABILITIES[id].effect.plantEntryBonus;
            });
            const plantComplete = attackEntry > computed[def].area;
            gameState.plantComplete = plantComplete;
            $('round-content').innerHTML = `
            <div class="result-section fade-in">
                <h3>ãƒ—ãƒ©ãƒ³ãƒˆåˆ¤å®š</h3>
                <p style="margin:15px 0;">æ”»æ’ƒã‚¨ãƒ³ãƒˆãƒªãƒ¼(${attackEntry}) vs é˜²è¡›ã‚¨ãƒªã‚¢(${computed[def].area})</p>
                <div class="plant-badge ${plantComplete ? 'complete' : 'incomplete'}">
                    ${plantComplete ? 'ğŸ’£ ãƒ—ãƒ©ãƒ³ãƒˆå®Œäº†!' : 'ğŸ›¡ï¸ ãƒ—ãƒ©ãƒ³ãƒˆé˜»æ­¢'}
                </div>
                <div class="nav-buttons" style="margin-top:30px;">
                    <button class="btn btn-primary" onclick="stepKillCalculation()">ã‚­ãƒ«æ•°è¨ˆç®—ã¸</button>
                </div>
            </div>
        `;
        }

        function stepKillCalculation() {
            $('phase-display').textContent = 'âš”ï¸ ã‚­ãƒ«æ•°è¨ˆç®—';
            const killCounts = calculateKills(gameState.computed);
            gameState.killCounts = killCounts;
            const atk = gameState.roles.attacker, def = gameState.roles.defender;
            const hasKills = killCounts[atk] > 0 || killCounts[def] > 0;
            $('round-content').innerHTML = `
            <div class="result-section fade-in">
                <h3>ã‚­ãƒ«æ•°è¨ˆç®—çµæœ</h3>
                <p style="margin:10px 0;font-size:0.85rem;color:var(--text-secondary);">150ãƒ€ãƒ¡ãƒ¼ã‚¸ = 1ã‚­ãƒ«</p>
                <div class="stats-comparison">
                    <div class="stats-column">
                        <h4>${atk} (æ”»æ’ƒ)</h4>
                        <div class="kill-info">ğŸ—¡ï¸ ${killCounts[atk]} ã‚­ãƒ«</div>
                </div>
                    <div class="vs-divider">âš”ï¸</div>
                    <div class="stats-column">
                        <h4>${def} (é˜²è¡›)</h4>
                        <div class="kill-info">ğŸ—¡ï¸ ${killCounts[def]} ã‚­ãƒ«</div>
                    </div>
                </div>
                <div class="nav-buttons" style="margin-top:30px;">
                    <button class="btn btn-primary" onclick="${hasKills ? 'stepKillSelection()' : 'stepWinnerDetermination()'}">
                        ${hasKills ? 'ã‚­ãƒ«é¸æŠã¸' : 'å‹æ•—åˆ¤å®š'}
                    </button>
                </div>
            </div>
        `;
        }

        async function stepKillSelection() {
            for (const victim of ['P1', 'P2']) {
                const killer = victim === 'P1' ? 'P2' : 'P1';
                const killCount = gameState.killCounts[killer];
                if (killCount > 0) {
                    gameState.killSelecting = victim;
                    gameState.tempKillSelection = [];

                    // PvEæ™‚: P2ï¼ˆNPCï¼‰ã®ã‚­ãƒ«é¸æŠã¯è‡ªå‹•
                    if (gameState.gameMode === 'pve' && victim === 'P2') {
                        const npcSelections = npcSelectKillTargets(killCount);
                        npcSelections.forEach(agentId => {
                            gameState.tempKillSelection.push(agentId);
                            const agent = gameState.decks.P2.find(a => a.id === agentId);
                            if (agent) agent.killed = true;
                        });
                    } else {
                        await showKillSelection(victim, killCount);
                    }
                }
            }
            showScreen('round-screen');
            $('phase-display').textContent = 'â˜ ï¸ ã‚­ãƒ«ç¢ºå®š';
            const atk = gameState.roles.attacker, def = gameState.roles.defender;
            const atkAlive = gameState.decks[atk].filter(a => !a.killed).length;
            const defAlive = gameState.decks[def].filter(a => !a.killed).length;
            $('round-content').innerHTML = `
                < div class="result-section fade-in" >
                <h3>ã‚­ãƒ«ç¢ºå®š</h3>
                <div class="stats-comparison">
                    <div class="stats-column"><h4>${atk} (æ”»æ’ƒ)</h4><div class="kill-info">ç”Ÿå­˜: ${atkAlive}ä½“</div></div>
                    <div class="vs-divider">âš”ï¸</div>
                    <div class="stats-column"><h4>${def} (é˜²è¡›)</h4><div class="kill-info">ç”Ÿå­˜: ${defAlive}ä½“</div></div>
                </div>
                <div class="nav-buttons" style="margin-top:30px;">
                    <button class="btn btn-primary" onclick="stepWinnerDetermination()">å‹æ•—åˆ¤å®š</button>
                </div>
            </div >
                `;
        }

        function calculateStats() {
            const computed = { P1: { damage: 0, entry: 0, area: 0, retake: 0 }, P2: { damage: 0, entry: 0, area: 0, retake: 0 } };

            // Step 1: è‡ªåˆ†ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆåŸºæœ¬å€¤ + ã‚¢ãƒ“ãƒªãƒ†ã‚£åŠ¹æœï¼‰ã‚’é›†è¨ˆ
            ['P1', 'P2'].forEach(player => {
                gameState.decks[player].forEach(agent => {
                    if (agent.killed) return;
                    computed[player].damage += agent.baseStats.damage;
                    computed[player].entry += agent.baseStats.entry;
                    computed[player].area += agent.baseStats.area;
                    computed[player].retake += agent.baseStats.retake;
                    (gameState.purchases[player][agent.id] || []).forEach(abilityId => {
                        const ability = ABILITIES[abilityId];
                        // statåŠ¹æœã¨mixedåŠ¹æœã®è‡ªå·±ãƒãƒ•éƒ¨åˆ†ã‚’é©ç”¨
                        if (ability.effect.damage) computed[player].damage += ability.effect.damage;
                        if (ability.effect.entry) computed[player].entry += ability.effect.entry;
                        if (ability.effect.area) computed[player].area += ability.effect.area;
                        if (ability.effect.retake) computed[player].retake += ability.effect.retake;
                    });
                });
            });

            // Step 2: ç›¸æ‰‹ã¸ã®åŠ¹æœï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸æ¸›å°‘ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ¸›å°‘ã€ãƒªãƒ†ã‚¤ã‚¯æ¸›å°‘ï¼‰ã‚’é©ç”¨
            ['P1', 'P2'].forEach(player => {
                const opponent = player === 'P1' ? 'P2' : 'P1';
                Object.values(gameState.purchases[player]).flat().forEach(abilityId => {
                    const effect = ABILITIES[abilityId].effect;
                    // ç›¸æ‰‹ãƒ€ãƒ¡ãƒ¼ã‚¸æ¸›å°‘
                    if (effect.reduceEnemyDamage) {
                        computed[opponent].damage = Math.max(0, computed[opponent].damage - effect.reduceEnemyDamage);
                    }
                    // ç›¸æ‰‹ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ¸›å°‘
                    if (effect.reduceEnemyEntry) {
                        computed[opponent].entry = Math.max(0, computed[opponent].entry - effect.reduceEnemyEntry);
                    }
                    // ç›¸æ‰‹ãƒªãƒ†ã‚¤ã‚¯æ¸›å°‘
                    if (effect.reduceEnemyRetake) {
                        computed[opponent].retake = Math.max(0, computed[opponent].retake - effect.reduceEnemyRetake);
                    }
                });
            });

            return computed;
        }

        function calculateKills(computed) {
            const killCounts = {};
            ['P1', 'P2'].forEach(player => {
                const opponent = player === 'P1' ? 'P2' : 'P1';
                const opponentAlive = gameState.decks[opponent].filter(a => !a.killed).length;
                let kills = Math.floor(computed[player].damage / 150);
                kills = Math.min(kills, opponentAlive);
                killCounts[player] = kills;
            });
            ['P1', 'P2'].forEach(player => {
                Object.values(gameState.purchases[player]).flat().forEach(abilityId => {
                    if (ABILITIES[abilityId].effect.extraKill) {
                        const opponent = player === 'P1' ? 'P2' : 'P1';
                        const opponentAlive = gameState.decks[opponent].filter(a => !a.killed).length;
                        if (killCounts[player] < opponentAlive) {
                            killCounts[player] = Math.min(killCounts[player] + ABILITIES[abilityId].effect.extraKill, opponentAlive);
                        }
                    }
                });
            });
            return killCounts;
        }

        function showKillSelection(player, killCount) {
            return new Promise(resolve => {
                showScreen('kill-screen');
                $('kill-instruction').textContent = `${player}: ${killCount}ä½“ã‚’é¸æŠã—ã¦ã‚­ãƒ«ã•ã‚Œã¾ã™`;
                const deck = gameState.decks[player].filter(a => !a.killed);
                const purchases = gameState.purchases[player];
                $('kill-select-grid').innerHTML = deck.map(agent => {
                    const agentPurchases = purchases[agent.id] || [];
                    // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨ˆç®—
                    const stats = { ...agent.baseStats };
                    agentPurchases.forEach(abilityId => {
                        const effect = ABILITIES[abilityId].effect;
                        if (effect.damage) stats.damage += effect.damage;
                        if (effect.entry) stats.entry += effect.entry;
                        if (effect.area) stats.area += effect.area;
                        if (effect.retake) stats.retake += effect.retake;
                    });
                    return `
                    <div class="kill-select-card" data-id="${agent.id}" onclick="toggleKillSelect('${agent.id}')">
                        <div class="card-portrait" style="height:50px;font-size:1.8rem;">${agent.icon}</div>
                        <div class="card-name">${agent.name}</div>
                        <div style="font-size:0.7rem;color:var(--text-secondary);margin:5px 0;">
                            DMG:${stats.damage} / ENT:${stats.entry} / AREA:${stats.area} / RET:${stats.retake}
                        </div>
                        <div style="font-size:0.65rem;border-top:1px solid var(--border-color);padding-top:8px;margin-top:8px;text-align:left;">
                            ${agent.abilities.map(abilityId => {
                        const ability = ABILITIES[abilityId];
                        const purchased = agentPurchases.includes(abilityId);
                        return `<div style="margin:4px 0;${purchased ? 'color:var(--accent-defense);' : 'color:var(--text-secondary);'}">
                                    <div style="display:flex;justify-content:space-between;align-items:center;">
                                        <span style="font-weight:600;">${ability.name} ($${ability.cost})</span>
                                        ${purchased ? '<span class="ability-badge">ACTIVE</span>' : ''}
                                    </div>
                                    <div style="font-size:0.6rem;opacity:0.8;margin-top:2px;">â€” ${ability.desc}</div>
                                </div>`;
                    }).join('')}
                        </div>
                    </div>
                `;
                }).join('');
                $('confirm-kill-btn').disabled = true;
                window.currentKillResolve = resolve;
                window.requiredKills = killCount;
            });
        }

        function toggleKillSelect(agentId) {
            const card = document.querySelector(`.kill-select-card[data-id="${agentId}"]`);
            const idx = gameState.tempKillSelection.indexOf(agentId);
            if (idx > -1) { gameState.tempKillSelection.splice(idx, 1); card.classList.remove('selected'); }
            else if (gameState.tempKillSelection.length < window.requiredKills) { gameState.tempKillSelection.push(agentId); card.classList.add('selected'); }
            $('confirm-kill-btn').disabled = gameState.tempKillSelection.length !== window.requiredKills;
        }

        function confirmKillSelection() {
            const player = gameState.killSelecting;
            gameState.tempKillSelection.forEach(agentId => {
                const agent = gameState.decks[player].find(a => a.id === agentId);
                if (agent) agent.killed = true;
                gameState.killed[player].push(agentId);
            });
            gameState.tempKillSelection = [];
            showScreen('round-screen');
            if (window.currentKillResolve) window.currentKillResolve();
        }

        function stepWinnerDetermination() {
            $('phase-display').textContent = 'ğŸ† å‹æ•—åˆ¤å®š';
            const atk = gameState.roles.attacker, def = gameState.roles.defender;
            const atkAlive = gameState.decks[atk].filter(a => !a.killed).length;
            const defAlive = gameState.decks[def].filter(a => !a.killed).length;
            let winner = null, reason = '';
            let forceAttackWin = false;
            if (gameState.plantComplete) {
                ['P1', 'P2'].forEach(p => {
                    Object.values(gameState.purchases[p]).flat().forEach(id => {
                        if (ABILITIES[id].effect.forceAttackWin) forceAttackWin = true;
                    });
                });
            }
            if (atkAlive === 0 && defAlive === 0) {
                winner = (gameState.plantComplete || forceAttackWin) ? atk : def;
                reason = (gameState.plantComplete || forceAttackWin) ? 'ãƒ—ãƒ©ãƒ³ãƒˆå®Œäº†ã«ã‚ˆã‚Šæ”»æ’ƒå‹åˆ©' : 'ãƒ—ãƒ©ãƒ³ãƒˆé˜»æ­¢ã«ã‚ˆã‚Šé˜²è¡›å‹åˆ©';
            } else if (atkAlive === 0) { winner = def; reason = 'æ”»æ’ƒå´å…¨æ»…ï¼é˜²è¡›å‹åˆ©'; }
            else if (defAlive === 0) { winner = atk; reason = 'é˜²è¡›å´å…¨æ»…ï¼æ”»æ’ƒå‹åˆ©'; }
            else {
                let atkArea = 0, defRetake = 0;
                gameState.decks[atk].forEach(a => { if (!a.killed) atkArea += a.baseStats.area; });
                gameState.decks[def].forEach(a => { if (!a.killed) defRetake += a.baseStats.retake; });
                Object.values(gameState.purchases[atk]).flat().forEach(id => { if (ABILITIES[id].effect.areaBonus) atkArea += ABILITIES[id].effect.areaBonus; });
                Object.values(gameState.purchases[def]).flat().forEach(id => { if (ABILITIES[id].effect.retakeBonus) defRetake += ABILITIES[id].effect.retakeBonus; });
                if (atkArea > defRetake) { winner = atk; reason = `ã‚¨ãƒªã‚¢(${atkArea}) > ãƒªãƒ†ã‚¤ã‚¯(${defRetake}) ã§æ”»æ’ƒå‹åˆ©`; }
                else if (defRetake > atkArea) { winner = def; reason = `ãƒªãƒ†ã‚¤ã‚¯(${defRetake}) > ã‚¨ãƒªã‚¢(${atkArea}) ã§é˜²è¡›å‹åˆ©`; }
                else { winner = gameState.plantComplete ? atk : def; reason = `åŒå€¤ï¼${gameState.plantComplete ? 'ãƒ—ãƒ©ãƒ³ãƒˆå®Œäº†ã§æ”»æ’ƒ' : 'ãƒ—ãƒ©ãƒ³ãƒˆé˜»æ­¢ã§é˜²è¡›'}å‹åˆ©`; }
            }
            gameState.scores[winner]++;
            updateHeader();
            const winnerRole = winner === atk ? 'attack' : 'defense';
            $('round-content').innerHTML = `
            <div class="result-section fade-in">
                <h3>ãƒ©ã‚¦ãƒ³ãƒ‰çµæœ</h3>
                <p style="margin:15px 0;">æ”»æ’ƒç”Ÿå­˜: ${atkAlive}ä½“ / é˜²è¡›ç”Ÿå­˜: ${defAlive}ä½“</p>
                <div class="winner-display ${winnerRole}">${winner}ã®å‹åˆ©ï¼</div>
                <p style="font-size:1rem;">${reason}</p>
                <div class="nav-buttons" style="margin-top:30px;">
                    <button class="btn btn-primary" onclick="nextRound()">æ¬¡ã¸</button>
                </div>
            </div>
        `;
        }

        function nextRound() {
            if (gameState.scores.P1 >= 3 || gameState.scores.P2 >= 3) { endGame(); return; }
            gameState.roundIndex++;
            if (gameState.roundIndex > 4) { endGame(); return; }
            if (gameState.roundIndex === 3) {
                gameState.setIndex = 2;
                const temp = gameState.roles.attacker;
                gameState.roles.attacker = gameState.roles.defender;
                gameState.roles.defender = temp;
            }
            gameState.decks.P1.forEach(a => a.killed = false);
            gameState.decks.P2.forEach(a => a.killed = false);
            startBuyPhase();
        }

        function endGame() {
            showScreen('end-screen');
            let result = '', resultClass = '';
            if (gameState.scores.P1 > gameState.scores.P2) { result = 'ğŸ† P1 ã®å‹åˆ©ï¼ ğŸ†'; resultClass = 'attack'; }
            else if (gameState.scores.P2 > gameState.scores.P1) { result = 'ğŸ† P2 ã®å‹åˆ©ï¼ ğŸ†'; resultClass = 'defense'; }
            else { result = 'ğŸ¤ å¼•ãåˆ†ã‘ ğŸ¤'; resultClass = 'draw'; }
            $('final-result').textContent = result;
            $('final-result').className = 'final-result winner-display ' + resultClass;
            $('final-scores').textContent = `P1: ${gameState.scores.P1} - P2: ${gameState.scores.P2}`;
        }
    </script>
</body>

</html>